(function(c){jQuery.expr[":"].focus=function(a){return a===document.activeElement&&(a.type||a.href)};c.widget("ui.toggleEdit",{options:{types:[],copyCss:true,eventsEnabled:true,events:{},listeners:{},delay:1E3,stickyFocus:true,defaultText:"    "},defaults:{events:{edit:"click",delayedit:false,canceledit:false,preview:"mouseleave",cancelpreview:"mouseenter",delaypreview:800},listeners:{edit:"p",canceledit:"p",preview:"i",cancelpreview:"i"}},_init:function(){this.options.events=c.extend(true,{},this.defaults.events,
this.options.events);this.options.listeners=c.extend(true,{},this.defaults.listeners,this.options.listeners);if(this.element.is(":submit")||this.element.is("input[type=hidden]"))return false;if(typeof this.element.data("toggleEdit-preview")!=="undefined"){this.clear();this.disableEvents()}this.p=c('<div class="toggleEdit toggleEdit-preview toggleEdit-preview-'+this._tag(this.element)+'"></div>').insertAfter(this.element);this.element.addClass("toggleEdit toggleEdit-edit toggleEdit-edit-"+this._tag(this.element)).data("toggleEdit-preview",
this.p);(this.eventsEnabled=this.options.eventsEnabled)?this.enableEvents():this._initHandlers()},toggle:function(){this.editmode?this.preview():this.edit()},edit:function(a,b){this.editmode=true;this.text=this._parseValue(this.element);this.p.hide();this.element.show();b||this._trigger("onedit",a,{text:this.text,preview:this.p,element:this.element})},preview:function(a,b){if(this.options.stickyFocus){var d=this._getTypeInput(this.element);if(typeof this.handlers==="undefined")this.handlers={preview:null};
d.unbind("blur",this.handlers.preview.trigger);if(d.is(":focus")){d.bind("blur",this.handlers.preview.trigger);return false}}this.editmode=false;this.text=this._parseValue(this.element);this.element.hide();this._setup();this.p.show();b||this._trigger("onpreview",a,{text:this.text,preview:this.p,element:this.element})},previewEl:function(){return this.p},_tag:function(a){return a.get(0).tagName.toLowerCase()},_getTypeInput:function(a){var b;for(b=0;b<this.options.types.length;b++)if(c.isFunction(this.options.types[b].is)&&
c.isFunction(this.options.types[b].input))if(this.options.types[b].is(a))return this.options.types[b].input(a);return a},_parseValue:function(){var a;for(a=0;a<this.options.types.length;a++)if(c.isFunction(this.options.types[a].is)&&c.isFunction(this.options.types[a].text))if(this.options.types[a].is(e))return(a=this.options.types[a].text(e))?a:this.options.defaultText;if(this.element.is("select"))return this.element.find("option[value="+this.element.val()+"]").text();else{if(this.element.is(":checkbox"))return this.element.is(":checked")?
"Yes":"No";return(a=this.element.val())?a:this.options.defaultText}},_listner:function(a){switch(a){case "e":return this.element;case "p":return this.p;case "i":return this._getTypeInput(this.element);default:return c(a)}},_setup:function(){var a={};if(this.options.copyCss){var b=this.element.width(),d=this.element.height(),f=this.element.css("display"),g=this.element.css("float");if(!this.element.is(":checkbox")){if(this.element.is('input[type="text"],select'))a.whiteSpace="nowrap";if(b)a.minWidth=
b;if(d)a.height=d}if(f)a.display=f;if(g)a["float"]=g}this.p.css(a).html(this.text)},_initHandlers:function(){var a=this;a.handlers={preview:{trigger:function(b){if(a.options.events.delaypreview)a.handlers.preview.timeout=setTimeout(function(){a.preview(b)},a.options.events.delaypreview);else a.preview(b)},cancel:function(){clearTimeout(a.handlers.preview.timeout);a._trigger("cancelpreview",event,{text:a.text,preview:a.p,element:a.element})}},edit:{trigger:function(b){if(a.options.events.delayedit)a.handlers.edit.timeout=
setTimeout(function(){a.edit(b)},a.options.events.delayedit);else a.edit(b)},cancel:function(){clearTimeout(a.handlers.edit.timeout);a._trigger("canceledit",event,{text:a.text,preview:a.p,element:a.element})}}}},enableEvents:function(a){var b=this;b.editmode=true;b._initHandlers();b._listner(b.options.listeners.edit).bind(b.options.events.edit,b.handlers.edit.trigger);if(b.options.events.canceledit&&b.options.events.delayedit){b.handlers.edit.cancel=function(){clearTimeout(b.handlers.edit.timeout)};
b._listner(b.options.listeners.canceledit).bind(b.options.events.canceledit,b.handlers.edit.cancel)}b._listner(b.options.listeners.preview).bind(b.options.events.preview,b.handlers.preview.trigger);if(b.options.events.cancelpreview&&b.options.events.delaypreview){b.handlers.preview.cancel=function(){clearTimeout(b.handlers.preview.timeout)};b._listner(b.options.listeners.cancelpreview).bind(b.options.events.cancelpreview,b.handlers.preview.cancel)}a?b.edit(false,true):b.preview(false,true);b.eventsEnabled=
true},disableEvents:function(){this.element.unbind(this.options.events.preview,this.handlers.preview.trigger);this.handlers.preview.cancel&&this.element.unbind(this.options.events.cancelpreview,this.handlers.preview.cancel);this.element.unbind(this.options.events.edit,this.handlers.edit.trigger);this.handlers.edit.cancel&&this.element.unbind(this.options.events.canceledit,this.handlers.edit.cancel);this.eventsEnabled=false},clear:function(){this.element.data("toggleEdit-preview").remove();this.element.data("toggleEdit-preview",
null);this.element.show()},destroy:function(){this.clear();this.disableEvents();c.Widget.prototype.destroy.apply(this,arguments)}})})(jQuery);